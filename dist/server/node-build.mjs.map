{"version":3,"file":"node-build.mjs","sources":["../../server/lib/email.ts","../../server/lib/email-logger.ts","../../server/routes/contact.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import nodemailer from 'nodemailer';\n\n// Konfigurasi transporter email\nconst createTransporter = () => {\n  return nodemailer.createTransport({\n    service: 'gmail', // Menggunakan Gmail service untuk email institusi\n    auth: {\n      user: process.env.EMAIL_USER, // Email pengirim (bem.filkom@unida.ac.id)\n      pass: process.env.EMAIL_PASS, // Password\n    },\n  });\n};\n\nexport interface EmailData {\n  name: string;\n  email: string;\n  subject: string;\n  message: string;\n}\n\nexport const sendContactEmail = async (data: EmailData): Promise<void> => {\n  const transporter = createTransporter();\n  \n  const mailOptions = {\n    from: process.env.EMAIL_USER, // Email pengirim (bem.filkom@unida.ac.id)\n    to: 'bem.filkom@unida.ac.id', // Email tujuan (sama dengan pengirim)\n    subject: `[Contact Form] ${data.subject || 'Pesan dari ' + data.name}`,\n    html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px;\">\n          Pesan Baru dari Website BEM FILKOM\n        </h2>\n        \n        <div style=\"background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n          <h3 style=\"color: #495057; margin-top: 0;\">Detail Pengirim:</h3>\n          <p><strong>Nama:</strong> ${data.name}</p>\n          <p><strong>Email:</strong> ${data.email}</p>\n          <p><strong>Subject:</strong> ${data.subject || 'Tidak ada subject'}</p>\n        </div>\n        \n        <div style=\"background-color: #ffffff; padding: 20px; border: 1px solid #dee2e6; border-radius: 8px;\">\n          <h3 style=\"color: #495057; margin-top: 0;\">Pesan:</h3>\n          <p style=\"line-height: 1.6; color: #333;\">${data.message.replace(/\\n/g, '<br>')}</p>\n        </div>\n        \n        <div style=\"margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 8px; font-size: 12px; color: #6c757d;\">\n          <p><strong>Waktu:</strong> ${new Date().toLocaleString('id-ID', { \n            timeZone: 'Asia/Jakarta',\n            year: 'numeric',\n            month: 'long',\n            day: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit'\n          })}</p>\n          <p><strong>Dikirim dari:</strong> Website BEM FILKOM Universitas Djuanda</p>\n        </div>\n      </div>\n    `,\n    text: `\nPesan Baru dari Website BEM FILKOM\n\nDetail Pengirim:\n- Nama: ${data.name}\n- Email: ${data.email}\n- Subject: ${data.subject || 'Tidak ada subject'}\n\nPesan:\n${data.message}\n\nWaktu: ${new Date().toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' })}\nDikirim dari: Website BEM FILKOM Universitas Djuanda\n    `,\n  };\n\n  try {\n    await transporter.sendMail(mailOptions);\n    console.log('Email berhasil dikirim ke bem.filkom@unida.ac.id');\n  } catch (error) {\n    console.error('Error mengirim email:', error);\n    throw new Error('Gagal mengirim email. Silakan coba lagi nanti.');\n  }\n};\n","import 'dotenv/config';\n\n// Solusi sederhana: Simpan pesan dan kirim notifikasi\nexport interface EmailData {\n  name: string;\n  email: string;\n  subject: string;\n  message: string;\n}\n\nexport const logContactMessage = async (data: EmailData): Promise<void> => {\n  const timestamp = new Date().toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' });\n  \n  const logMessage = `\n========================================\nPESAN BARU DARI WEBSITE BEM FILKOM\n========================================\nWaktu: ${timestamp}\nNama: ${data.name}\nEmail: ${data.email}\nSubject: ${data.subject || 'Tidak ada subject'}\nPesan:\n${data.message}\n========================================\n`;\n\n  console.log(logMessage);\n  \n  // Simpan ke file log\n  const fs = await import('fs');\n  const logFile = 'contact-messages.log';\n  \n  try {\n    fs.appendFileSync(logFile, logMessage + '\\n');\n    console.log(`âœ… Pesan tersimpan di ${logFile}`);\n  } catch (error) {\n    console.error('Error menyimpan log:', error);\n  }\n};\n","import { Router } from \"express\";\nimport { ContactCreateResponse, ContactListResponse, ContactMessage, ContactMessageInput } from \"@shared/api\";\nimport { sendContactEmail } from \"../lib/email\";\nimport { logContactMessage } from \"../lib/email-logger\";\n\nexport const contactRouter = Router();\n\nconst messages: ContactMessage[] = [];\n\ncontactRouter.get(\"/\", (_req, res) => {\n  const response: ContactListResponse = { ok: true, messages };\n  res.status(200).json(response);\n});\n\ncontactRouter.post(\"/\", async (req, res) => {\n  const body: ContactMessageInput = req.body ?? {};\n  const name = String(body.name || \"\").trim();\n  const email = String(body.email || \"\").trim();\n  const subject = String(body.subject || \"\").trim();\n  const message = String(body.message || \"\").trim();\n\n  if (!name || !email || !message) {\n    return res.status(400).json({ ok: false, error: \"Missing required fields\" });\n  }\n\n  const item: ContactMessage = {\n    id: `${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\n    name,\n    email,\n    subject,\n    message,\n    createdAt: new Date().toISOString(),\n  };\n  messages.unshift(item);\n\n  // Kirim email ke bem.filkom@unida.ac.id dengan logging sebagai backup\n  try {\n    // Coba kirim email dulu\n    await sendContactEmail({ name, email, subject, message });\n    console.log('âœ… Email berhasil dikirim ke bem.filkom@unida.ac.id');\n  } catch (emailError) {\n    console.log('âŒ Email gagal, menggunakan logging sebagai backup...');\n    // Backup: Log pesan ke file dan console\n    await logContactMessage({ name, email, subject, message });\n  }\n\n  const response: ContactCreateResponse = { ok: true, message: item };\n  res.status(201).json(response);\n});\n","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { contactRouter } from \"./routes/contact\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // Example API routes\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  // Contact API\n  app.use(\"/api/contact\", contactRouter);\n\n  return app;\n}\n","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files from multiple possible locations\napp.use(express.static(distPath));\napp.use(express.static(path.join(__dirname, \"../spa/assets\")));\n\n// Add health check endpoint\napp.get(\"/health\", (_req, res) => {\n  res.json({ status: \"ok\", timestamp: new Date().toISOString() });\n});\n\n// Handle React Router - serve index.html for all non-API routes\napp.use((req, res, next) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return next();\n  }\n\n  // Skip if it's a static file request\n  if (req.path.includes(\".\")) {\n    return next();\n  }\n\n  const indexPath = path.join(distPath, \"index.html\");\n  console.log(`Serving index.html from: ${indexPath} for path: ${req.path}`);\n\n  // Serve index.html for all other routes\n  res.sendFile(indexPath);\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["app","express"],"mappings":"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"}